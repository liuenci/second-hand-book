<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>二手书交易平台</title>
    <link rel="stylesheet" href="static/css/common/bootstrap.css">
</head>

<body>
    <embed src="static/html/common/header.html" width="100%" height="72px" />
    <div class="container">
        <form class="form-horizontal" role="form">
            <div class="form-group">
                <div class="col-sm-8 col-sm-offset-1">
                    <input type="text" class="form-control" id="search" placeholder="请输入名字">
                </div>
                <div class="col-sm-2">
                    <button type="button" class="btn btn-default btn-success" id="btn-book-search"
                        onclick="getDataList()">搜索</button>
                </div>
            </div>
        </form>
        <div class="row" id="div-container" style="margin-top:20px">

        </div>
    </div>
</body>
<script src="./static/js/common/jquery-3.1.1.min.js"></script>
<script src="./static/js/common/bootstrap.js"></script>
<script>
    function getDataList() {
        var name = $('#search').val()
        $.ajax({
            url: 'http://localhost:8080/book/list',
            type: 'get',
            async: false,
            data: {
                name: name
            },
            dataType: 'json',
            success: function (result) {
                $('#div-container').empty()
                var data = result.rows
                for (let index = 0; index < data.length; index++) {
                    const element = data[index];
                    console.log(element);
                    var div = $('<div>');
                    div.addClass('col-sm-2')
                    div.css('height', '300px')


                    // 追加图片
                    var img = $('<img>');
                    img.css('cursor', 'pointer')
                    var imgName = element.imgName == null ? 'default.jpg' : element.imgName
                    img.attr('src', "static/image/" + imgName)
                    img.attr('width', "100%")
                    img.attr('height', "70%")
                    img.css('border', '1px solid black')
                    img.click(function () {
                        localStorage.setItem("bookId", element.id)
                        window.location = 'detail.html'
                    })
                    div.append(img)

                    // 追加书名
                    var p1 = $('<p>')
                    p1.text(element.name)
                    div.append(p1)

                    // 追加作者
                    var p2 = $('<p>')
                    p2.text(element.author + ' 著')
                    div.append(p2)

                    // 追加金额
                    var p3 = $('<p>')
                    p3.text('￥' + element.price)
                    p3.css('color', 'red')
                    div.append(p3)
                    $('#div-container').append(div)
                }
            }
        })
    }
    $(function(){
        getDataList()
    })
</script>

</html>